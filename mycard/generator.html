<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KLD â€“ Digital Card Generator</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b0f14">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:Inter,system-ui;
  background:#0b0f14;
  color:#fff;
  overflow:hidden;
}
.header{
  text-align:center;
  padding:16px;
  font-size:22px;
  font-weight:700;
}
.header span{
  display:block;
  font-size:13px;
  opacity:.7;
}
.container{
  max-width:780px;
  margin:auto;
  padding:16px;
  height:calc(100vh - 80px);
  overflow:auto;
}
input,select,textarea{
  width:100%;
  padding:12px;
  margin:6px 0;
  border:none;
  border-radius:10px;
  background:#1b1f2a;
  color:#fff;
}
textarea{height:220px;font-size:13px;}
.row{display:flex;gap:8px;}

button{
  width:100%;
  padding:14px;
  margin-top:8px;
  border:none;
  border-radius:14px;
  font-size:14px;
  cursor:pointer;
}
.btn-generate{background:#6c5ce7;}
.btn-preview{background:#e17055;}
.btn-download{background:#fdcb6e;color:#000;}

.social-box{
  background:#222736;
  padding:8px 10px;
  border-radius:8px;
  font-size:13px;
  margin-bottom:6px;
}

.toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:#000;
  color:#fff;
  padding:10px 16px;
  border-radius:20px;
  opacity:0;
  transition:.3s;
}
.toast.show{opacity:1;}
</style>
</head>

<body>

<div class="header">
  KLD
  <span>Digital Card Generator</span>
</div>

<div class="container">

<input id="fullName" placeholder="Full Name">
<input id="shop" placeholder="Shop / Business Name">
<input id="email" placeholder="Email">
<input id="phone" placeholder="Phone Number">

<input id="photoUrl" placeholder="Profile Image URL (auto)">
<input type="file" id="photoFile" accept="image/*">

<div class="row">
  <select id="layout">
    <option value="glass">Glass Card</option>
    <option value="outline">Outline Card</option>
    <option value="minimal">Minimal Card</option>
  </select>
  <select id="borderMode">
    <option value="animated">Animated Border</option>
    <option value="static">Static Border</option>
  </select>
</div>

<div class="row">
  <select id="socialType">
    <option value="instagram">Instagram</option>
    <option value="whatsapp">WhatsApp</option>
    <option value="facebook">Facebook</option>
    <option value="linkedin">LinkedIn</option>
    <option value="twitter">X</option>
    <option value="snapchat">Snapchat</option>
    <option value="github">GitHub</option>
    <option value="youtube">YouTube</option>
  </select>
  <input id="socialLink" placeholder="Username or full link">
</div>

<button onclick="addSocial()">+ Add Social</button>
<div id="socialList"></div>

<button class="btn-generate" onclick="generate()">Generate HTML</button>
<button id="previewBtn" class="btn-preview" onclick="preview()" style="display:none;">Preview</button>
<button class="btn-download" onclick="downloadHTML()">Download HTML</button>

<textarea id="result" placeholder="Generated HTML code"></textarea>

</div>

<div id="toast" class="toast"></div>

<script>
/* ===== SERVICE WORKER ===== */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("service-worker.js");
}

let socials=[], previewURL=null;

/* ===== TOAST ===== */
function toast(msg){
  const t=document.getElementById("toast");
  t.textContent=msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2000);
}

/* ===== IMAGE AUTO UPLOAD ===== */
photoFile.addEventListener("change", async ()=>{
  const file=photoFile.files[0];
  if(!file) return;
  const fd=new FormData();
  fd.append("image",file);
  toast("Uploading image...");
  try{
    const r=await fetch("https://api.imgbb.com/1/upload?key=1ad5f21ba833f28e031a13dd608a5777",{method:"POST",body:fd});
    const d=await r.json();
    if(d.success){
      photoUrl.value=d.data.url;
      toast("Photo upload successful");
    }else toast("Upload failed");
  }catch{toast("Upload error")}
});

/* ===== SOCIAL URL BUILDER ===== */
function buildSocialURL(type,val){
  if(val.startsWith("http")) return val;
  switch(type){
    case "instagram": return "https://instagram.com/"+val;
    case "facebook": return "https://facebook.com/"+val;
    case "linkedin": return "https://linkedin.com/in/"+val;
    case "twitter": return "https://x.com/"+val;
    case "github": return "https://github.com/"+val;
    case "youtube": return "https://youtube.com/@"+val;
    case "snapchat": return "https://snapchat.com/add/"+val;
    case "whatsapp": return "https://wa.me/"+val.replace(/\D/g,"");
    default:return val;
  }
}

function addSocial(){
  if(!socialLink.value) return;
  const link=buildSocialURL(socialType.value,socialLink.value.trim());
  socials.push({type:socialType.value,link});
  const d=document.createElement("div");
  d.className="social-box";
  d.textContent=socialType.value+" : "+link;
  socialList.appendChild(d);
  socialLink.value="";
}

/* ===== GENERATE ===== */
function generate(){
  const fn=fullName.value, sh=shop.value, em=email.value, ph=phone.value, img=photoUrl.value;
<button onclick="autoDeploy()" style="background:#00c7b7;color:#000">
ðŸš€ Deploy Live
</button>

<div id="liveBox" style="
  margin-top:10px;
  padding:10px;
  background:#111;
  border-radius:10px;
  display:none;
">
  <div style="font-size:13px;opacity:.7">Live URL</div>
  <input id="liveUrl" readonly>
</div>
  const icons={
    instagram:"fa-instagram",whatsapp:"fa-whatsapp",facebook:"fa-facebook",
    linkedin:"fa-linkedin",twitter:"fa-x-twitter",
    snapchat:"fa-snapchat",github:"fa-github",youtube:"fa-youtube"
  };

  const socialsHTML=socials.map(s=>`<a href="${s.link}" target="_blank"><i class="fa-brands ${icons[s.type]}"></i></a>`).join("");

  const vcard=encodeURIComponent(
`BEGIN:VCARD
VERSION:3.0
FN:${fn}
ORG:${sh}
TEL:${ph}
EMAIL:${em}
END:VCARD`
  );

  const html=`<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
html,body{margin:0;height:100%;overflow:hidden;font-family:Inter,system-ui;background:#0b0f14;color:#fff;}
.wrapper{height:100%;display:flex;align-items:center;justify-content:center;}
.card{width:100%;max-width:520px;padding:40px 28px;border-radius:26px;background:rgba(255,255,255,0.08);text-align:center;}
.avatar{width:150px;height:150px;margin:0 auto 20px;border-radius:50%;border:5px solid #6c5ce7;}
.avatar img{width:100%;height:100%;border-radius:50%;object-fit:cover;}
h1{margin:8px 0 4px;font-size:26px;}
.shop{opacity:.85;}
.actions a{display:inline-block;margin:6px;padding:8px 14px;border-radius:20px;background:#6c5ce7;color:#fff;text-decoration:none;font-size:13px;}
.socials{margin-top:18px;display:flex;justify-content:center;gap:20px;}
.socials a{font-size:24px;color:#6c5ce7;}
</style>
</head>
<body>
<div class="wrapper">
  <div class="card">
    ${img?`<div class="avatar"><img src="${img}"></div>`:""}
    <h1>${fn}</h1>
    <div class="shop">${sh}</div>
    <div class="actions">
      <a href="tel:${ph}">Call</a>
      <a href="mailto:${em}">Email</a>
      <a href="data:text/vcard;charset=utf-8,${vcard}" download="contact.vcf">Save Contact</a>
    </div>
    <div class="socials">${socialsHTML}</div>
  </div>
</div>
</body>
</html>`;

  result.value=html;
  previewBtn.style.display="block";
  toast("HTML generated");
}

function preview(){
  const b=new Blob([result.value],{type:"text/html"});
  if(previewURL) URL.revokeObjectURL(previewURL);
  previewURL=URL.createObjectURL(b);
  window.open(previewURL);
}

function downloadHTML(){
  const b=new Blob([result.value],{type:"text/html"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download="index.html";
  a.click();
}
  async function autoDeploy(){
  if(!result.value){
    showToast("Generate HTML first");
    return;
  }

  showToast("Deploying...");

  try{
    const res = await fetch(
      "https://auto-deploy-worker.kuldeeptech-ai.workers.dev",
      {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ html: result.value })
      }
    );

    const data = await res.json();

    if(data.url){
      document.getElementById("liveUrl").value = data.url;
      document.getElementById("liveBox").style.display = "block";
      showToast("Live deployed");
      window.open(data.url, "_blank");
    }else{
      showToast("Deploy failed");
    }
  }catch(e){
    showToast("Server error");
  }
  }
</script>

</body>
</html>
